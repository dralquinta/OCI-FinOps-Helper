# Cost Collector v2.1 - New Features Quick Reference

## What Changed

### 1. ✅ REST API Integration
- Now uses `oci optimizer recommendation-summary list` command
- More reliable than raw API calls
- Properly handles authentication and region routing

### 2. ✅ Actionable Output Format
**Before:** Raw JSON (hard to understand)
**Now:** Two formats:
- `recommendations.out` - Human-readable actionable steps
- `recommendations.json` - Raw JSON for programmatic access

### 3. ✅ Currency Configuration
```bash
# Specify currency for cost display (default: USD)
./collector.sh <OCID> us-ashburn-1 2025-11-01 2025-11-20 --currency EUR
```

### 4. ✅ Aggregated Report with Categories
The report now includes:
- **Executive Summary**: Total savings, priority breakdown
- **Savings by Category**: Descriptive names instead of technical codes
- **Actionable Steps**: Specific actions with explanations and CLI commands
- **What This Means**: Detailed explanation of each recommendation

### 5. ✅ Stage Control for Testing
Skip stages to speed up testing:

```bash
# Only fetch recommendations (fastest for testing)
./collector.sh <OCID> us-ashburn-1 2025-11-01 2025-11-20 --only-recommendations

# Skip specific stages
./collector.sh <OCID> us-ashburn-1 2025-11-01 2025-11-20 --skip-recommendations
./collector.sh <OCID> us-ashburn-1 2025-11-01 2025-11-20 --skip-enrichment
./collector.sh <OCID> us-ashburn-1 2025-11-01 2025-11-20 --skip-cost --skip-usage
```

## Output Files

| File | Purpose |
|------|---------|
| `recommendations.out` | **NEW** - Human-readable actionable report |
| `recommendations.json` | **NEW** - Raw JSON data |
| `output_merged.csv` | Cost/usage data with enrichment |
| `output.csv` | Basic cost data |
| `out.json` | Raw API responses |
| `instance_metadata.json` | Instance details |

## Sample Output Structure

```
================================================================================
ORACLE CLOUD ADVISOR - COST OPTIMIZATION RECOMMENDATIONS
================================================================================
Generated: 2025-11-20 18:25:00
Tenancy: ocid1.tenancy...
Region: us-ashburn-1

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
EXECUTIVE SUMMARY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
Total Recommendations:       22
Active Recommendations:      22
Critical Priority:           3
High Priority:               1
Estimated Monthly Savings:   4,394.98 USD

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
SAVINGS BY CATEGORY
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Boot Volumes - Optimize size and performance settings
   Priority:           MODERATE
   Potential Savings:  1,756.00 USD
   Affected Resources: 700
   Status:             ACTIVE

2. Compute Commitments - Purchase 1-3 year commitments for discounts
   Priority:           MODERATE
   Potential Savings:  1,169.13 USD
   Affected Resources: 3
   Status:             ACTIVE

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
ACTIONABLE RECOMMENDATIONS (PRIORITIZED)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[1] COST-MANAGEMENT-COMPUTE-HOST-TERMINATED-NAME
────────────────────────────────────────────────────────────────────────────────
Priority:        CRITICAL
Savings:         9.74 USD/month
Status:          ACTIVE
Resources:       1 resource(s) affected
Description:     cost-management-compute-host-terminated-desc
Recommendation:  ocid1.optimizerrecommendation...

WHAT THIS MEANS:
  You have 1 compute instance(s) in TERMINATED or STOPPED state that still 
  have associated resources (boot volumes, reserved IPs) incurring costs.

ACTIONS TO TAKE:
  1. List the 1 terminated/stopped instance(s)
  2. Verify these instances are no longer needed
  3. Delete associated boot volumes
  4. Release any reserved public IPs

CLI COMMAND TO EXECUTE:
  oci compute instance list --compartment-id <tenancy-ocid> \
    --lifecycle-state TERMINATED --region us-ashburn-1
```

## Command Line Options

```bash
usage: collector.py [-h] [--currency CURRENCY] [--skip-cost] [--skip-usage]
                    [--skip-enrichment] [--skip-recommendations]
                    [--only-recommendations]
                    tenancy_ocid home_region from_date to_date

positional arguments:
  tenancy_ocid          OCI Tenancy OCID
  home_region           Home region (e.g., us-ashburn-1)
  from_date             Start date (YYYY-MM-DD)
  to_date               End date (YYYY-MM-DD)

optional arguments:
  -h, --help            show this help message and exit
  --currency CURRENCY   Currency for recommendations (default: USD)
  --skip-cost           Skip cost data collection
  --skip-usage          Skip usage data collection
  --skip-enrichment     Skip instance metadata enrichment
  --skip-recommendations
                        Skip recommendations collection
  --only-recommendations
                        Only fetch recommendations (skip all other stages)
```

## Use Cases

### Quick Testing
```bash
# Fastest - only recommendations (3-5 seconds)
./collector.sh <OCID> us-ashburn-1 2025-11-01 2025-11-20 --only-recommendations
```

### Production Run
```bash
# Full collection (default USD currency)
./collector.sh <OCID> us-ashburn-1 2025-11-01 2025-11-30

# With custom currency
./collector.sh <OCID> us-ashburn-1 2025-11-01 2025-11-30 --currency EUR
```

### Cost Data Only
```bash
# Skip recommendations for faster runtime
./collector.sh <OCID> us-ashburn-1 2025-11-01 2025-11-30 --skip-recommendations
```

## Implementation Notes

1. **API Method**: Uses `oci optimizer recommendation-summary list` command which is a reliable wrapper around the OCI REST API
2. **Currency**: Defaults to USD, can be overridden with `--currency` flag (e.g., EUR, GBP, MXN)
3. **Category Names**: Human-readable descriptions instead of technical codes
4. **Explanations**: Each recommendation includes "What This Means" section explaining the optimization
5. **CLI Commands**: Exact OCI CLI commands provided for each recommendation type
6. **Actionable Steps**: Intelligently generated based on recommendation type (volumes, instances, commitments, etc.)
7. **Sorting**: Recommendations sorted by priority (CRITICAL > HIGH > MODERATE > LOW) then by savings amount

## Troubleshooting

If recommendations fail:
1. Check OCI CLI is authenticated: `oci iam region list`
2. Verify home region is correct
3. Ensure you have Cloud Advisor permissions
4. Try `--only-recommendations` mode to isolate the issue

## Next Steps

1. Review `output/recommendations.out` for actionable steps
2. Prioritize CRITICAL and HIGH recommendations
3. Focus on categories with highest savings
4. Implement changes via OCI Console or CLI
5. Mark recommendations as IMPLEMENTED in Cloud Advisor
